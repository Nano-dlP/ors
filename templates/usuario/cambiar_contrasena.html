{% extends 'core/index.html' %}
{% load static %}
{% load widget_tweaks %}

{% block extra_css %}
  <link href="{% static 'css/expedientes.css' %}" rel="stylesheet">
{% endblock extra_css %}

{% block page_content %}
<div class="container mt-5">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">

      <div class="card shadow border-0 rounded-4 custom-card">
        <!-- Encabezado -->
        <div class="card-header bg-primary text-white fw-semibold d-flex align-items-center gap-2">
          {% block form_icon %}<i class="fas fa-edit"></i>{% endblock %}
          <span>{% block form_title %}Cambiar contraseña — {{ request.user.get_full_name|default:request.user.username }}{% endblock %}</span>
        </div><!-- Contenido -->

        <div class="card-body">
              
              <form method="post" novalidate>
    {% csrf_token %}
      <div class="mb-3">
    <label for="{{ form.password_actual.id_for_label }}" class="form-label">
      Contraseña actual
    </label>
    {% render_field form.password_actual class="form-control rounded-3" placeholder="Ingrese su contraseña actual" %}
    {% for error in form.password_actual.errors %}
      <div class="text-danger small fst-italic">{{ error }}</div>
    {% endfor %}
  </div>

  <div class="mb-3">
    <label for="{{ form.nueva_password.id_for_label }}" class="form-label fw-semibold">
      Nueva contraseña
    </label>
    {% render_field form.nueva_password class="form-control rounded-3" placeholder="Ingrese la nueva contraseña" %}
    {% for error in form.nueva_password.errors %}
      <div class="text-danger small fst-italic">{{ error }}</div>
    {% endfor %}
  </div>

  <div class="mb-3">
    <label for="{{ form.confirmar_password.id_for_label }}" class="form-label fw-semibold">
      Confirmar nueva contraseña
    </label>
    {% render_field form.confirmar_password class="form-control rounded-3" placeholder="Repita la nueva contraseña" %}
    {% for error in form.confirmar_password.errors %}
      <div class="text-danger small fst-italic">{{ error }}</div>
    {% endfor %}
  </div>

    <div id="password-requirements" class="mt-3 p-3 rounded border">
      <p class="fw-bold mb-2">La nueva contraseña debe contener:</p>
      <ul class="list-unstyled mb-0">
        <li id="req-length">❌ Al menos 8 caracteres</li>
        <li id="req-lower">❌ Una letra minúscula</li>
        <li id="req-upper">❌ Una letra mayúscula</li>
        <li id="req-digit">❌ Un número</li>
        <li id="req-special">❌ Un carácter especial</li>
      </ul>
    </div>

    <div class="text-center mt-4">
      <button type="submit" class="btn btn-primary">Cambiar contraseña</button>
    </div>
  </form>
          
        </div>
      </div>

    </div>
  </div>
</div>
<script>
document.addEventListener("DOMContentLoaded", () => {
  const passwordInput = document.getElementById("id_nueva_password");
  const requirements = {
    length: document.getElementById("req-length"),
    lower: document.getElementById("req-lower"),
    upper: document.getElementById("req-upper"),
    digit: document.getElementById("req-digit"),
    special: document.getElementById("req-special"),
  };

  const specialChars = /[!#$%&()*+,\-./:;<=>?@[\]^_{|}~]/;

  passwordInput.addEventListener("input", () => {
    const value = passwordInput.value;

    // Actualiza cada requisito en tiempo real
    requirements.length.textContent = value.length >= 8 ? "✅ Al menos 8 caracteres" : "❌ Al menos 8 caracteres";
    requirements.lower.textContent = /[a-z]/.test(value) ? "✅ Una letra minúscula" : "❌ Una letra minúscula";
    requirements.upper.textContent = /[A-Z]/.test(value) ? "✅ Una letra mayúscula" : "❌ Una letra mayúscula";
    requirements.digit.textContent = /\d/.test(value) ? "✅ Un número" : "❌ Un número";
    requirements.special.textContent = specialChars.test(value) ? "✅ Un carácter especial" : "❌ Un carácter especial";
  });
});
</script>
{% endblock page_content %}
