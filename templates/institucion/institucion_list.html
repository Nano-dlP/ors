{% extends 'core/index.html' %}
{% load static %}

{% block page_content %}

<!-- Begin Page Content -->
<div class="container-fluid">
  <!-- Page Heading -->
  <div class="d-sm-flex align-items-center justify-content-between mb-4">
    <p class="h5 mb-0 text-gray-800">Listado de Instituciones</p>
    <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i class="fas fa-download fa-sm text-white-50"></i> Descargar archivo</a>
  </div>

  <!-- Content Row -->
  <div class="row">
    <!-- Content Row -->
    {% block body %}
      <div class="row">
        <!-- Area Chart -->
        <div class="col">
          <div class="card shadow">
            <!-- Card Header - Dropdown -->
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
              <p class="h6 mb-0 text-gray-800 text-primary">INSTITUCIONES</p>
                <div class="dropdown no-arrow">
                  <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                  </a>
                  <!-- Asegúrate de incluir Bootstrap Icons en tu <head> si aún no lo hiciste -->
                  <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"> -->

                    <div class="dropdown-menu dropdown-menu-end shadow-lg border-0 p-2 rounded-3" aria-labelledby="dropdownMenuLink" style="min-width: 200px;">
                      <h6 class="dropdown-header text-primary fw-semibold">⚙️ Acciones</h6>
                      <a class="dropdown-item d-flex align-items-center gap-2" href="{% url 'institucion:institucion_create' %}">
                        <i class="bi bi-plus-circle-fill text-success"></i> Agregar
                      </a>

                      <a class="dropdown-item d-flex align-items-center gap-2" href="#">
                        <i class="bi bi-search text-info"></i> Buscar
                      </a>

                      <a class="dropdown-item d-flex align-items-center gap-2" href="#">
                        <i class="bi bi-printer-fill text-secondary"></i> Imprimir
                      </a>

                      <div class="dropdown-divider"></div>

                      <a class="dropdown-item d-flex align-items-center gap-2 text-danger" href="#">
                        <i class="bi bi-box-arrow-right"></i> Salir
                      </a>
                    </div>

                  </div>
            </div>
            <!-- Card Body -->
            <div class="card-body" style="height: 100%;">
            {% if not instituciones %}
              <div class="alert alert-warning" role="alert">
              No hay Instituciones registradas.
            </div>
            {% else %}
              <div class="table-responsive table-sm">
                <table class="table table-striped table-hover" id="id_tabla_inst" width="100%">
                  <thead class="thead-dark">
                    <tr>
                      <th>ID</th>
                      <th>Institución</th>
                      <th>Localidad</th>
                      <th>Teléfono</th>
                      <th>Correo</th>
                      <th>CUIT</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for institucion in instituciones %}
                    <tr>
                      <td>{{ institucion.id }}</td>
                      <td>{{ institucion.institucion }}</td>
                      <td>{{ institucion.localidad }}</td>
                      <td>{{ institucion.telefono }}</td>
                      <td>{{ institucion.email }}</td>
                      <td>{{ institucion.cuit }}</td>
                      <td>
                        <a href="{% url 'institucion:institucion_edit' institucion.id %}" class="btn btn-warning btn-circle" title="Editar"><i class="far fa-edit"></i></a>
                        <a href="{% url 'institucion:institucion_detail' institucion.id %}" class="btn btn-info btn-circle" title="Detalles"><i class="fas fa-eye"></i></a>
                        <a href="{% url 'institucion:institucion_inactivate' institucion.id %}" class="btn btn-danger btn-circle" title="Borrar"><i class="far fa-trash-alt"></i></a>
                        <a href="#" class="btn btn-warning btn-circle" data-id="{{ institucion.id }}" data-action="desactivar" data-entity="la institucion {{ institucion.institucion }}" onclick="mostrarModal(this)"><i class="fas fa-power-off"></i></a>
  
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% endif %}
            </div>
          </div>
        </div>
      </div>
    {% endblock body %}
  </div>
</div>
<!-- Modal de confirmación -->
<div class="modal fade" id="modalConfirmacion" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="modalConfirmacionLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title" id="modalConfirmacionLabel">Confirmar acción</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
      </div>

      <div class="modal-body" id="modalMensaje">
        <!-- Se completa dinámicamente -->
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <form id="formAccion" method="post">
          {% csrf_token %}
          <button type="submit" class="btn btn-danger" id="btnConfirmarAccion">Confirmar</button>
        </form>
      </div>

    </div>
  </div>
</div>
<script>
  function mostrarModal(elemento) {
    const id = elemento.getAttribute('data-id');
    const action = elemento.getAttribute('data-action');
    const entity = elemento.getAttribute('data-entity');

    const mensaje = `¿Estás seguro de que deseas <strong>${action}</strong> a ${entity}?`;
    document.getElementById('modalMensaje').innerHTML = mensaje;

    const form = document.getElementById('formAccion');
    form.action = `/persona/${id}/${action}/`;  // Ajustá esta ruta si es necesario

    const btnConfirmar = document.getElementById('btnConfirmarAccion');
    btnConfirmar.classList.remove('btn-danger', 'btn-warning');
    btnConfirmar.classList.add(action === 'eliminar' ? 'btn-danger' : 'btn-warning');
    btnConfirmar.textContent = action.charAt(0).toUpperCase() + action.slice(1);

    const modal = new bootstrap.Modal(document.getElementById('modalConfirmacion'));
    modal.show();
  }
</script>



{% endblock page_content %}

{% block js_page %}
<script>
  $(document).ready(function () {
    $('#id_tabla_inst').DataTable({
      pageLength: 5,
      lengthMenu: [5, 10, 20, 50],
      language: {
        url: "{% static '/es-ES.json' %}"
      }
    });
  });
</script>
{% endblock js_page %}
