{% extends 'core/index.html' %}
{% load static %}
{% include "institucion/modal_confirmacion.html" %}


{% block page_content %}

<!-- Begin Page Content -->
<div class="container-fluid">
  <!-- Page Heading -->
  <div class="d-sm-flex align-items-center justify-content-between mb-4">
    <p class="h5 mb-0 text-gray-800">Listado de Instituciones</p>
    <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i class="fas fa-download fa-sm text-white-50"></i> Descargar archivo</a>
  </div>

  <!-- Content Row -->
  <div class="row">
    <!-- Content Row -->
    {% block body %}
      <div class="row">
        <!-- Area Chart -->
        <div class="col">
          <div class="card shadow">
            <!-- Card Header - Dropdown -->
            <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
              <p class="h6 mb-0 text-gray-800 text-primary">INSTITUCIONES</p>
                <div class="dropdown no-arrow">
                  <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                  </a>
                  <!-- Asegúrate de incluir Bootstrap Icons en tu <head> si aún no lo hiciste -->
                  <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet"> -->

                    <div class="dropdown-menu dropdown-menu-end shadow-lg border-0 p-2 rounded-3" aria-labelledby="dropdownMenuLink" style="min-width: 200px;">
                      <h6 class="dropdown-header text-primary fw-semibold">⚙️ Acciones</h6>
                      <a class="dropdown-item d-flex align-items-center gap-2" href="{% url 'institucion:institucion_create' %}">
                        <i class="bi bi-plus-circle-fill text-success"></i> Agregar
                      </a>

                      <a class="dropdown-item d-flex align-items-center gap-2" href="#">
                        <i class="bi bi-search text-info"></i> Buscar
                      </a>

                      <a class="dropdown-item d-flex align-items-center gap-2" href="#">
                        <i class="bi bi-printer-fill text-secondary"></i> Imprimir
                      </a>

                      <div class="dropdown-divider"></div>

                      <a class="dropdown-item d-flex align-items-center gap-2 text-danger" href="#">
                        <i class="bi bi-box-arrow-right"></i> Salir
                      </a>
                    </div>

                  </div>
            </div>
            <!-- Card Body -->
            <div class="card-body" style="height: 100%;">
            {% if not instituciones %}
              <div class="alert alert-warning" role="alert">
              No hay Instituciones registradas.
            </div>
            {% else %}
              <div class="table-responsive table-sm">
                <table class="table table-striped table-hover" id="id_tabla_inst" width="100%">
                  <thead class="thead-dark">
                    <tr>
                      <th>ID</th>
                      <th>Institución</th>
                      <th>Localidad</th>
                      <th>Teléfono</th>
                      <th>Correo</th>
                      <th>CUIT</th>
                      <th>Acciones</th>
                    </tr>
                  </thead>
                  <tbody>
                    {% for institucion in instituciones %}
                    <tr>
                      <td>{{ institucion.id }}</td>
                      <td>{{ institucion.institucion }}</td>
                      <td>{{ institucion.localidad }}</td>
                      <td>{{ institucion.telefono }}</td>
                      <td>{{ institucion.email }}</td>
                      <td>{{ institucion.cuit }}</td>
                      <td>
                        <a href="{% url 'institucion:institucion_edit' institucion.id %}" class="btn btn-warning btn-circle" title="Editar"><i class="far fa-edit"></i></a>
                        <a href="{% url 'institucion:institucion_detail' institucion.id %}" class="btn btn-info btn-circle" title="Detalles"><i class="fas fa-eye"></i></a>
                        <a href="#" class="btn btn-danger btn-circle" title="Desactivar" onclick="mostrarModal(this)" data-id="{{ institucion.id }}" data-url="{% url 'institucion:institucion_deactivate' 0 %}"><i class="far fa-trash-alt"></i>
</a>

  
                      </td>
                    </tr>
                    {% endfor %}
                  </tbody>
                </table>
              </div>
            {% endif %}
            </div>
          </div>
        </div>
      </div>
      
<!-- templates/includes/modal_confirmacion.html -->
<div class="modal fade" id="modalConfirmacion" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <form method="post" id="formConfirmacion">
        {% csrf_token %}
        <div class="modal-header bg-warning text-dark">
          <h5 class="modal-title">Confirmar acción</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
        </div>
        <div class="modal-body">
          <p>¿Estás seguro de que querés realizar esta acción?</p>
        </div>
        <div class="modal-footer">
          <a href="{% url 'institucion:institucion_list' %}" class="btn btn-secondary">Cancelar</a>
          <button type="submit" class="btn btn-danger">Confirmar</button>
        </div>
      </form>
    </div>
  </div>
</div>



    {% endblock body %}
  </div>
</div>
<script>
function mostrarModal(elemento) {
    const form = document.getElementById('formConfirmacion');
    const id = elemento.getAttribute('data-id');
    const url = elemento.getAttribute('data-url').replace('0', id);
    form.action = url;

    const modal = new bootstrap.Modal(document.getElementById('modalConfirmacion'));
    modal.show();
}
</script>


{% endblock page_content %}

{% block js_page %}
<script>
  $(document).ready(function () {
    $('#id_tabla_inst').DataTable({
      pageLength: 5,
      lengthMenu: [5, 10, 20, 50],
      language: {
        url: "{% static '/es-ES.json' %}"
      }
    });
  });
</script>
{% endblock js_page %}
