{% extends "core/index.html" %}
{% load static %}

{% block page_content %}
<!-- CSS externo -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  .etiqueta {
    font-weight: bold;
    background-color: #f0f4fa;
    padding: 3px 8px;
    border-radius: 5px;
    color: #3463a3;
    display: block;
    margin-bottom: 2px;
  }
  .contenido {
    color: #222;
    display: block;
    margin-bottom: 10px;
    margin-left: 2px;
  }
</style>

<div class="container mt-4">
  <!-- Encabezado principal -->
  <div class="card shadow-lg border-0 rounded-4">
    <div class="card-header bg-gradient bg-primary text-white rounded-top-4 py-3 position-relative">
      <h5 class="mb-0">
        <i class="fas fa-file-alt me-2"></i>Chau Detalle de Expediente - {{ expediente.medio_ingreso }}
      </h5>
      <span class="badge bg-light text-dark position-absolute top-50 end-0 translate-middle-y me-4 fs-6 shadow-sm">
        {{ expediente.identificador }}
      </span>
    </div>

    <div class="card-body bg-light rounded-bottom-4">
      <!-- Sección: Inicio -->
      <div class="card mb-3">
        <div class="card-body">
          <h6 class="border-bottom pb-2 mb-3"><i class="fas fa-play"></i> Inicio</h6>
          <div class="row">
            <div class="col-md-4 mb-3">
              <div class="etiqueta"><i class="fas fa-mail-bulk me-2"></i> Medio de ingreso</div>
              <div class="contenido">{{ expediente.medio_ingreso }}</div>
            </div>
            <div class="col-md-4 mb-3">
              <div class="etiqueta"><i class="fas fa-university me-2"></i> Sede</div>
              <div class="contenido">{{ expediente.sede }}</div>
            </div>
            <div class="col-md-4 mb-3">
              <div class="etiqueta"><i class="fas fa-calendar-plus me-2"></i> Fecha de creación</div>
              <div class="contenido">{{ expediente.fecha_creacion|date:"d/m/Y" }}</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Sección: Datos del oficio -->
      <div class="card mb-3">
        <div class="card-body">
          <h6 class="border-bottom pb-2 mb-3"><i class="fas fa-file-alt"></i> Datos del oficio</h6>
          <div class="row">
            <div class="col-md-8 mb-3">
              <div class="etiqueta"><i class="fas fa-building me-2"></i> Institución</div>
              <div class="contenido">{{ institucion }}</div>
            </div>
            <div class="col-md-4 mb-3">
              <div class="etiqueta"><i class="fas fa-calendar-day me-2"></i> Fecha de Juzgado</div>
              <div class="contenido">{{ expediente.fecha_de_juzgado }}</div>
            </div>
          </div>
          <div class="row mt-3">
            <div class="col-md-4 mb-3">
              <div class="etiqueta"><i class="fas fa-calendar-check me-2"></i> Fecha de Recepción</div>
              <div class="contenido">{{ expediente.fecha_de_recepcion }}</div>
            </div>
            <div class="col-md-4 mb-3">
              <div class="etiqueta"><i class="fas fa-id-card me-2"></i> CUIJ</div>
              <div class="contenido">{{ expediente.cuij }}</div>
            </div>
            <div class="col-md-4 mb-3">
              <div class="etiqueta"><i class="fas fa-key me-2"></i> Clave SISFE</div>
              <div class="contenido">{{ expediente.clave_sisfe }}</div>
            </div>
          </div>
          <div class="row mt-2">
            <div class="col-md-10">
              <div class="etiqueta"><i class="fas fa-archive me-2"></i> Expediente Físico</div>
              <div class="contenido">{{ expediente.expediente_fisico|yesno:"Sí,No" }}</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Sección: Información complementaria -->
      <div class="card mb-3">
        <div class="card-body">
          <h6 class="border-bottom pb-2 mb-3"><i class="fas fa-info-circle"></i> Información complementaria</h6>
          <div class="row align-items-end">
            <div class="col-md-4 mb-3">
              <div class="etiqueta"><i class="fas fa-file-alt me-2"></i> Tipo de solicitud</div>
              <div class="contenido">{{ expediente.tipo_solicitud }}</div>
            </div>
            <div class="col-md-3 mb-3">
              <div class="etiqueta"><i class="fas fa-folder-open me-2"></i> Estado expediente</div>
              <div class="contenido">{{ expediente.estado_expediente }}</div>
            </div>
            <div class="col-md-2 mb-3">
              <div class="etiqueta"><i class="fas fa-user-clock me-2"></i> Edad</div>
              <div class="contenido">{{ expediente.edad_persona }}</div>
            </div>
            <div class="col-md-3 mb-3">
              <div class="etiqueta"><i class="fas fa-users me-2"></i> Grupo Etario</div>
              <div class="contenido">{{ expediente.grupo_etario }}</div>
            </div>
          </div>
          <div class="row align-items-end mt-2">
            <div class="col-md-6 mb-3">
              <div class="etiqueta"><i class="fas fa-gavel me-2"></i> Tipo de patrocinio</div>
              <div class="contenido">{{ expediente.tipo_patrocinio }}</div>
            </div>
            <div class="col-md-6 mb-3">
              <div class="etiqueta"><i class="fas fa-comment-dots me-2"></i> Resumen intervención</div>
              <div class="contenido">{{ expediente.resumen_intervencion }}</div>
            </div>
          </div>
          <div class="row align-items-end mt-2">
            <div class="col-md-6 mb-3">
              <div class="etiqueta"><i class="fas fa-home me-2"></i> Situación habitacional histórica</div>
              <div class="contenido">{{ expediente.situacion_habitacional_hist }}</div>
            </div>
            <div class="col-md-6 mb-3">
              <div class="etiqueta"><i class="fas fa-comment-medical me-2"></i> Observaciones</div>
              <div class="contenido">{{ expediente.observaciones }}</div>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Sección: Documentos adjuntos -->
      <div>
        <h6 class="fw-bold mb-3">
          <i class="fas fa-paperclip text-primary"></i> Documentos adjuntos
        </h6>
        <ul class="list-group list-group-flush mb-3">
          {% for doc in documentos %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <a href="{{ doc.archivo.url }}" class="text-decoration-none text-primary fw-semibold" target="_blank">
                  <i class="fas fa-file-alt me-2"></i>{{ doc.nombre }}
                </a>
                <span class="text-muted small ms-2">{{ doc.fecha_subida|date:"d/m/Y" }}</span>
              </div>
              <form method="post" action="{% url 'expediente:expediente_documento_delete' doc.pk %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-outline-danger shadow-sm" 
                        title="Eliminar" aria-label="Eliminar documento"
                        onclick="return confirm('¿Seguro que deseas borrar este documento?')">
                  <i class="fas fa-trash-alt"></i>
                </button>
              </form>
            </li>
          {% empty %}
            <li class="list-group-item text-muted">No hay documentos adjuntos.</li>
          {% endfor %}
        </ul>
        <!-- Formulario para agregar documento -->
        <form method="post" action="{% url 'expediente:expediente_agregar_documento' expediente.id %}" 
              enctype="multipart/form-data" 
              class="row g-2 align-items-end">
          {% csrf_token %}
          <div class="col-md-5">
            <input type="text" name="nombre" class="form-control shadow-sm" placeholder="Nombre del documento" required>
          </div>
          <div class="col-md-5">
            <input type="file" name="archivo" class="form-control shadow-sm" required>
          </div>
          <div class="col text-end">
            <button type="submit" class="btn btn-secondary px-4 shadow-sm">
              <i class="fas fa-plus"></i> Agregar
            </button>
          </div>
        </form>
      </div>

      <!-- Botón volver -->
      <div class="text-end mt-4">
        <a href="{% url 'expediente:expediente_list' %}" 
           class="btn btn-outline-primary px-4 shadow-sm">
          <i class="fas fa-arrow-left me-2"></i>Volver al listado
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %}