{% extends 'core/index.html' %} 
{% load widget_tweaks %}
{% load static %}

{% block page_content %}
<style>
  /* Igualar select2 al estilo de Bootstrap form-select */
.select2-container .select2-selection--single {
    height: 48px !important;
    border-radius: 0.375rem !important; /* Bootstrap 5 default */
    border: 1px solid #ced4da !important;
    background-color: #fff !important;
    color: #495057 !important;
    font-size: 1rem !important;
    padding: 0.375rem 0.75rem !important;
    box-shadow: none !important;
    display: flex !important;
    align-items: center !important;
}
.select2-container--default .select2-selection--single .select2-selection__rendered {
    line-height: 48px !important;
}
.select2-container--default .select2-selection--single .select2-selection__arrow {
    height: 48px !important;
    top: 0px !important;
}
.select2-dropdown {
    border-radius: 0.375rem !important;
}

  .custom-color { color: #4a6572 !important; }
  .custom-bg { background-color: #4a6572 !important; color: #fff !important; }
  .custom-btn {
    background-color: #4a6572 !important;
    color: #fff !important;
    border: none;
    box-shadow: 0 2px 8px rgba(74, 101, 114, 0.2);
  }
  .custom-btn:hover, .custom-btn:focus {
    background-color: #35505c !important;
    color: #fff !important;
  }
  .input-group-text.custom-bg { border: none; }
  .icon-btn { color: #fff !important; }
</style>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

<div class="container">
  <div class="card shadow-lg border-0 my-4 rounded-4">
    <div class="card-header custom-bg rounded-top-4 py-3">
      <h5 class="mb-0 fw-bold">
        <i class="fas fa-file-medical me-2 custom-color"></i> 
        Agregar Institución y Rol al Expediente 
        <span class="badge bg-light custom-color ms-2">{{ numero_expediente }}</span>
      </h5>
    </div>
    <div class="card-body bg-light rounded-bottom-4">
      <form method="post">
        {% csrf_token %}
        {{ form.expediente }}

        <div class="row mb-4 align-items-end">
          <div class="col-md-6">
            <label for="id_institucion" class="form-label fw-bold">
              <i class="fas fa-university me-2 custom-color"></i> Institución
            </label>
            <div class="input-group">
              {# Asegura el id para Select2 #}
              {% render_field form.institucion class="form-select border-0" id="id_institucion" style="width:100%" %}
            </div>
          </div>
          <div class="col-md-6">
            <label for="id_rol" class="form-label fw-bold">
              <i class="fas fa-user-tag me-2 custom-color"></i> Rol
            </label>
            <div class="input-group">
              {% render_field form.rol class="form-select border-0" %}
            </div>
          </div>
        </div>
        <div class="text-end">
          <button type="submit" class="btn custom-btn btn-lg px-4 py-2" title="Agregar">
            <i class="fas fa-plus-circle me-2 icon-btn"></i> Guardar
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
$(document).ready(function() {
    $('#id_institucion').select2({
        placeholder: 'Buscar institución...',
        ajax: {
            url: '{% url "expediente:buscar_instituciones" %}',
            dataType: 'json',
            delay: 250,
            data: function (params) {
                return { q: params.term };
            },
            processResults: function (data) {
                return {
                    results: data.results
                };
            },
            cache: true
        },
        minimumInputLength: 2,
        width: '100%'
    });
});
</script>
{% endblock page_content %}