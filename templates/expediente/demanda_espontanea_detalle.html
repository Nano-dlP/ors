{% extends "core/index.html" %}
{% load static %}

{% block page_content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  .etiqueta {
    font-weight: bold;
    background-color: #f0f4fa;
    padding: 3px 8px;
    border-radius: 5px;
    color: #4a6572 !important;
    display: block;
    margin-bottom: 2px;
  }
  .contenido {
    color: #222;
    display: block;
    margin-bottom: 15px;
    margin-left: 15px;
  }
</style>

<div class="container mt-4">
  <!-- Encabezado principal -->
  <div class="card shadow-lg border-0 rounded-4">
    <div class="card-header bg-gradient bg-primary text-white rounded-top-4 py-3 position-relative">
      <h5 class="mb-0">
        <i class="fas fa-file-alt me-2"></i> Detalle de Expediente - Demanda Espontánea
      </h5>
      <span class="badge bg-light text-dark position-absolute top-50 end-0 translate-middle-y me-4 fs-6 shadow-sm">
        {{ expediente.identificador }}
      </span>
    </div>
    <div class="card-body bg-light rounded-bottom-4">
      <!-- Datos principales -->
      <div class="row">
        <div class="col-md-4 mb-3">
          <div class="etiqueta"><i class="fas fa-calendar-plus me-2"></i> Fecha de creación</div>
          <div class="contenido">{{ expediente.fecha_creacion|date:"d/m/Y" }}</div>
        </div>
        <div class="col-md-4 mb-3">
          <div class="etiqueta"><i class="fas fa-user-circle me-2"></i> Persona</div>
          <div class="contenido">
            {% if persona %}
              {{ persona }}
            {% else %}
              <span class="text-muted">No asignada</span>
            {% endif %}
          </div>
        </div>
        <div class="col-md-4 mb-3">
          <div class="etiqueta"><i class="fas fa-university me-2"></i> Sede</div>
          <div class="contenido">{{ expediente.sede }}</div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-4 mb-3">
          <div class="etiqueta"><i class="fas fa-mail-bulk me-2"></i> Medio de ingreso</div>
          <div class="contenido">{{ expediente.medio_ingreso }}</div>
        </div>
        <div class="col-md-4 mb-3">
          <div class="etiqueta"><i class="fas fa-file-alt me-2"></i> Tipo de solicitud</div>
          <div class="contenido">{{ expediente.tipo_solicitud }}</div>
        </div>
        <div class="col-md-4 mb-3">
          <div class="etiqueta"><i class="fas fa-folder-open me-2"></i> Estado expediente</div>
          <div class="contenido">{{ expediente.estado_expediente }}</div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-4 mb-3">
          <div class="etiqueta"><i class="fas fa-users me-2"></i> Grupo etario</div>
          <div class="contenido">{{ expediente.grupo_etario }}</div>
        </div>
        <div class="col-md-4 mb-3">
          <div class="etiqueta"><i class="fas fa-user-clock me-2"></i> Edad persona</div>
          <div class="contenido">{{ expediente.edad_persona }}</div>
        </div>
        <div class="col-md-4 mb-3">
          <div class="etiqueta"><i class="fas fa-home me-2"></i> Situación habitacional</div>
          <div class="contenido">{{ expediente.situacion_habitacional_hist|default:"-" }}</div>
        </div>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <div class="etiqueta"><i class="fas fa-comment-dots me-2"></i> Resumen intervención</div>
          <div class="contenido">{{ expediente.resumen_intervencion }}</div>
        </div>
        <div class="col-md-6 mb-3">
          <div class="etiqueta"><i class="fas fa-comment-medical me-2"></i> Observaciones</div>
          <div class="contenido">{{ expediente.observaciones|default:"-" }}</div>
        </div>
      </div>

      <hr class="my-4">

      <!-- Documentos adjuntos -->
      <div>
        <h6 class="fw-bold mb-3" style="color: #4a6572 !important;">
          <i class="fas fa-paperclip" style="color: #4a6572 !important;"></i> Documentos adjuntos
        </h6>
        <ul class="list-group list-group-flush mb-3" >
          {% for doc in documentos %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
              <div>
                <a href="{{ doc.archivo.url }}" class="text-decoration-none text-primary fw-semibold" style="color: #4a6572 !important;"target="_blank">
                  <i class="fas fa-file-alt me-2"></i>{{ doc.nombre }}
                </a>
                <span class="text-muted small ms-2">{{ doc.fecha_subida|date:"d/m/Y" }}</span>
              </div>
              <form method="post" action="{% url 'expediente:expediente_documento_delete' doc.pk %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-outline-danger shadow-sm" 
                        title="Eliminar" aria-label="Eliminar documento"
                        onclick="return confirm('¿Seguro que deseas borrar este documento?')">
                  <i class="fas fa-trash-alt"></i>
                </button>
              </form>
            </li>
          {% empty %}
            <li class="list-group-item text-muted">No hay documentos adjuntos.</li>
          {% endfor %}
        </ul>
        <!-- Formulario para agregar documento -->
        <form method="post" action="{% url 'expediente:expediente_agregar_documento' expediente.id %}" 
              enctype="multipart/form-data" 
              class="row g-2 align-items-end">
          {% csrf_token %}
          <div class="col-md-5">
            <input type="text" name="nombre" class="form-control shadow-sm" placeholder="Nombre del documento" required>
          </div>
          <div class="col-md-5">
            <input type="file" name="archivo" class="form-control shadow-sm" style="color: #4a6572;" required>
          </div>
          <div class="col text-end">
            <button type="submit" class="btn btn-secondary px-4 shadow-sm" style="color: #4a6572; text-decoration: none;">
              <i class="fas fa-plus"></i> Agregar
            </button>
          </div>
        </form>
      </div>

      <!-- Botón volver -->
      <div class="text-end mt-4">
        <a href="{% url 'expediente:expediente_list' %}" style="color: #4a6572; text-decoration: none;"
           class="btn btn-outline-secondary px-4 shadow-sm">
          <i class="fas fa-arrow-left me-2" ></i>Volver al listado
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %}