{% extends "core/index.html" %}
{% load static %}

{% block page_content %}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="{% static 'css/detalle_demanda.css' %}">


<div class="container mt-4">

  <!-- Encabezado principal -->
  <div class="card shadow-lg border-0 rounded-4 animate__animated animate__fadeInDown">
    <div class="card-header bg-gradient bg-primary text-white rounded-top-4 py-3 position-relative">
      <h5 class="mb-0">
        <i class="fas fa-file-alt me-2"></i> Detalle de Expediente - Demanda Espontánea
      </h5>
      <span class="badge bg-light text-dark position-absolute top-50 end-0 translate-middle-y me-4 fs-6 shadow-sm">
        {{ expediente.identificador }}
      </span>
    </div>

    <div class="card-body bg-light rounded-bottom-4">
      <dl class="row mb-0">
        <dt class="col-md-4 text-secondary fw-semibold">Fecha de creación</dt>
        <dd class="col-md-8">{{ expediente.fecha_creacion|date:"d/m/Y" }}</dd>

        <dt class="col-md-4 text-secondary fw-semibold">Persona</dt>
        <dd class="col-md-8">
          {% if persona %}
            <i class="fas fa-user-circle text-primary"></i> {{ persona }}
          {% else %}
            <span class="text-muted">No asignada</span>
          {% endif %}
        </dd>

        <dt class="col-md-4 text-secondary fw-semibold">Sede</dt>
        <dd class="col-md-8">{{ expediente.sede }}</dd>

        <dt class="col-md-4 text-secondary fw-semibold">Medio de ingreso</dt>
        <dd class="col-md-8">{{ expediente.medio_ingreso }}</dd>

        <dt class="col-md-4 text-secondary fw-semibold">Tipo de solicitud</dt>
        <dd class="col-md-8">{{ expediente.tipo_solicitud }}</dd>

        <dt class="col-md-4 text-secondary fw-semibold">Estado expediente</dt>
        <dd class="col-md-8">{{ expediente.estado_expediente }}</dd>

        <dt class="col-md-4 text-secondary fw-semibold">Grupo etario</dt>
        <dd class="col-md-8">{{ expediente.grupo_etario }}</dd>

        <dt class="col-md-4 text-secondary fw-semibold">Edad persona</dt>
        <dd class="col-md-8">{{ expediente.edad_persona }}</dd>

        <dt class="col-md-4 text-secondary fw-semibold">Situación habitacional</dt>
        <dd class="col-md-8">{{ expediente.situacion_habitacional_hist|default:"-" }}</dd>

        <dt class="col-md-4 text-secondary fw-semibold">Resumen intervención</dt>
        <dd class="col-md-8">{{ expediente.resumen_intervencion }}</dd>

        <dt class="col-md-4 text-secondary fw-semibold">Observaciones</dt>
        <dd class="col-md-8">{{ expediente.observaciones|default:"-" }}</dd>
      </dl>

      <hr class="my-4">

      <!-- Documentos adjuntos -->
      <div>
        <h6 class="fw-bold mb-3">
          <i class="fas fa-paperclip text-primary"></i> Documentos adjuntos
        </h6>
        <ul class="list-group list-group-flush mb-3">
          {% for doc in documentos %}
            <li class="list-group-item d-flex justify-content-between align-items-center animate__animated animate__fadeInUp">
              <div>
                <a href="{{ doc.archivo.url }}" class="text-decoration-none text-primary fw-semibold" target="_blank">
                  <i class="fas fa-file-alt me-2"></i>{{ doc.nombre }}
                </a>
                <span class="text-muted small ms-2">{{ doc.fecha_subida|date:"d/m/Y" }}</span>
              </div>
              <form method="post" action="{% url 'expediente:expediente_documento_delete' doc.pk %}" style="display:inline;">
                {% csrf_token %}
                <button type="submit" class="btn btn-sm btn-outline-danger shadow-sm" 
                        title="Eliminar" aria-label="Eliminar documento"
                        onclick="return confirm('¿Seguro que deseas borrar este documento?')">
                  <i class="fas fa-trash-alt"></i>
                </button>
              </form>
            </li>
          {% empty %}
            <li class="list-group-item text-muted">No hay documentos adjuntos.</li>
          {% endfor %}
        </ul>

        <!-- Formulario para agregar documento -->
        <form method="post" action="{% url 'expediente:expediente_agregar_documento' expediente.id %}" 
              enctype="multipart/form-data" 
              class="row g-2 align-items-end animate__animated animate__fadeInLeft">
          {% csrf_token %}
          <div class="col-md-5">
            <input type="text" name="nombre" class="form-control shadow-sm" placeholder="Nombre del documento" required>
          </div>
          <div class="col-md-5">
            <input type="file" name="archivo" class="form-control shadow-sm" required>
          </div>
          <div class="col text-end">
            <button type="submit" class="btn btn-secondary px-4 shadow-sm">
              <i class="fas fa-plus"></i> Agregar
            </button>
          </div>
        </form>
      </div>

      <!-- Botón volver -->
      <div class="text-end mt-4 animate__animated animate__fadeInUp">
        <a href="{% url 'expediente:expediente_list' %}" 
           class="btn btn-outline-primary px-4 shadow-sm">
          <i class="fas fa-arrow-left me-2"></i>Volver al listado
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
